jQuery(document).ready((function(e){document.addEventListener("wpcf7mailsent",(function(e){e.detail.contactFormId;var n=e.detail.apiResponse.redirection_url;""!=n&&null!=n&&(window.location=n)}))})),jQuery(document).ready((function(e){function n(n){const i=n.find('input[name="_wpcf7"]').val();if(!window.CF7PayPal[i])if("undefined"!=typeof paypal)try{const a=paypal.CardFields({createOrder:function(n){return new Promise(((a,o)=>{t(!0,i);var c=e("form.wpcf7-form");let s=!0;c.find("input").each((function(){e(this).hasClass("wpcf7-validates-as-required")&&""===e(this).val()&&(s=!1)}));const d=c.find("#card-number-field-container"),f=c.find("#card-name-field-container"),l=c.find("#card-expiry-field-container"),u=c.find("#card-cvv-field-container");if(d.children().length&&f.children().length&&l.children().length&&u.children().length||(s=!1,c.find(".wpcf7-response-output").text("Please fill in all card details.")),!s)return t(!1,i),void o(new Error("One or more fields have an error."));console.log("createOrder process starting..."),c.find(".wpcf7-spinner").css({display:"inline-flex",visibility:"visible",opacity:"1"}),c.find(".wpcf7-response-output").hide();const p=e("input[name='cf7pe_amount']").attr("att-cf7pe-name");if(p){const n=e("input[name='"+p+"']");if(n.length){const e=parseFloat(n.val());isNaN(e)||(amount=e)}}var m={action:"cf7pe_create_order",form_id:i,amount:amount,payment_source:n.paymentSource};e.ajax({url:CF7PE_ajax_object.ajax_url,type:"POST",data:m,dataType:"json"}).then((function(e){if(1==e.status&&e.data&&e.data.id)a(e.data.id),c.find(".wpcf7-spinner").css({display:"inline-flex",visibility:"visible",opacity:"1"});else{const n=e.msg||"Failed to create order";r(n,i),o(new Error(n))}})).fail((function(e,n,a){t(!1,i);const c="Error creating order: "+a;r(c,i),o(new Error(c))}))}))},onApprove:function(n){return new Promise(((r,a)=>{const{orderID:o}=n,c=e("form.wpcf7-form").filter((function(){return e(this).find('input[name="_wpcf7"]').val()===i}));c.find(".wpcf7-spinner").css({display:"inline-flex",visibility:"visible",opacity:"1"}),c.find('input[name="payment_reference"]').remove();var s=e("<input>").attr("type","hidden").attr("name","payment_reference").val(o);c.append(s),t(!1,i),void 0!==window.wpcf7&&"function"==typeof window.wpcf7.submit&&(window.wpcf7.submit(c[0]),setTimeout((()=>{if(t(!1,i),c.find(".wpcf7-spinner").css("display","none"),c.find(".wpcf7-response-output").removeClass("wpcf7-validation-errors").addClass("wpcf7-mail-sent-ok").show(),CF7PE_ajax_object.dynamic_success_return_url){const e=CF7PE_ajax_object.dynamic_success_return_url&&""!==CF7PE_ajax_object.dynamic_success_return_url.trim()?CF7PE_ajax_object.dynamic_success_return_url:null;e&&""!==e.trim()&&(window.location.href=e)}else{const e=CF7PE_ajax_object.success_return_url&&""!==CF7PE_ajax_object.success_return_url.trim()?CF7PE_ajax_object.success_return_url:null;e&&""!==e.trim()&&(window.location.href=e)}r()}),1e3))}))},onError:function(e){t(!1,i),r("Payment error: "+e.message,i),n.find(".wpcf7-spinner").css("display","none")}});if(a.isEligible()){try{const e=a.NameField({onValidate:function(e){e.isEmpty&&n.find(".wpcf7-response-output").text("Please enter card holder name").show()}}),i=a.NumberField({onValidate:function(e){e.isEmpty&&n.find(".wpcf7-response-output").text("Please enter card number").show()}}),t=a.CVVField({onValidate:function(e){e.isEmpty&&n.find(".wpcf7-response-output").text("Please enter CVV").show()}}),r=a.ExpiryField({onValidate:function(e){e.isEmpty&&n.find(".wpcf7-response-output").text("Please enter expiry date").show()}}),o={name:n.find("#card-name-field-container")[0],number:n.find("#card-number-field-container")[0],cvv:n.find("#card-cvv-field-container")[0],expiry:n.find("#card-expiry-field-container")[0]};o.name&&e.render("#"+o.name.id),o.number&&i.render("#"+o.number.id),o.cvv&&t.render("#"+o.cvv.id),o.expiry&&r.render("#"+o.expiry.id)}catch(e){return void console.error("Error rendering PayPal card fields:",e)}n.off("submit.cf7paypal wpcf7submit.cf7paypal"),n.on("submit.cf7paypal",(function(n){if(!(e(this).find("#card-number-field-container").length>0))return!0;n.preventDefault(),n.stopPropagation();e(this).find('input[type="submit"]');return t(!0,i),a.submit().catch((e=>{t(!1,i),r(`Payment error : ${e.message}`,i)})),!1})),n.on("wpcf7submit.cf7paypal",(function(n){return!(e(this).find("#card-number-field-container").length>0)||(e(this).find('input[name="payment_reference"]').length?void 0:(n.preventDefault(),n.stopPropagation(),!1))})),window.CF7PayPal[i]=!0}else r("Card fields are not available for your browser/device",i)}catch(e){console.error("Error initializing PayPal Card Fields:",e),r("Failed to initialize payment form. Please check your configuration.",i)}else console.error("PayPal SDK not loaded. Please check your PayPal configuration.")}function i(){e("form.wpcf7-form").each((function(){const i=e(this);i.find("#card-number-field-container").length>0&&n(i)}))}window.CF7PayPal=window.CF7PayPal||{},i(),e(document).on("wpcf7:init",(function(){i()})),e(document).on("wpcf7:reset",(function(i){const t=e(i.target),r=t.find('input[name="_wpcf7"]').val();r&&window.CF7PayPal[r]&&(delete window.CF7PayPal[r],n(t))}));const t=(n,i)=>{const t=e("form.wpcf7-form").filter((function(){return e(this).find('input[name="_wpcf7"]').val()===i})).find(".overlay");t.length&&t.css("display",n?"block":"none").toggleClass("hidden",!n)},r=(n,i)=>{const t=e("form.wpcf7-form").filter((function(){return e(this).find('input[name="_wpcf7"]').val()===i})).find("#paymentResponse");t.length?(t.removeClass("hidden").text(n),setTimeout((function(){t.addClass("hidden").text("")}),5e3)):console.log("Payment message:",n)}}));